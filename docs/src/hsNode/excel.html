
                <html><style>body { overflow:hidden;}
            h1 { font-family: Arial, sans-serif; font-size: 24px; color: #44a; }
            p { margin:0; padding-top:5px; }
            br  { margin:0; padding:0; }
            .line { margin: 0 5px 0 0; padding-right: 5px; color:#999; background-color:#eef;  }
            comment { color: #080;} module { color: #804;}
            .listing { margin: 10px; border: 1px solid #ccc; 
                      font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, Courier, monospace;
                      font-size: 14px; line-height: 1.2em; 
                      overflow:scroll;
                      height:90%;
            }
            code { padding: 5px 0;}</style></html><body>
                <h1>excel.ts</h1>
                <div class='listing'><code><span id=1 class="line">&nbsp;&nbsp;&nbsp;1</span><comment>/**<br>
<span id=2 class="line">&nbsp;&nbsp;&nbsp;2</span>&nbsp;*&nbsp;#&nbsp;Excel&nbsp;<br>
<span id=3 class="line">&nbsp;&nbsp;&nbsp;3</span>&nbsp;*&nbsp;Convenience&nbsp;functions&nbsp;to&nbsp;access&nbsp;tables&nbsp;in&nbsp;Excel&nbsp;files.<br>
<span id=4 class="line">&nbsp;&nbsp;&nbsp;4</span>&nbsp;*&nbsp;Uses&nbsp;the&nbsp;{@link&nbsp;https://github.com/SheetJS/js-xlsx&nbsp;Sheet&nbsp;JS&nbsp;xlsx&nbsp;parser&nbsp;and&nbsp;writer}.<br>
<span id=5 class="line">&nbsp;&nbsp;&nbsp;5</span>&nbsp;*&nbsp;<br>
<span id=6 class="line">&nbsp;&nbsp;&nbsp;6</span>&nbsp;*&nbsp;#&nbsp;Excel&nbsp;related&nbsp;functions<br>
<span id=7 class="line">&nbsp;&nbsp;&nbsp;7</span>&nbsp;*&nbsp;-&nbsp;{@link&nbsp;excel.readFile&nbsp;readFile}&nbsp;<br>
<span id=8 class="line">&nbsp;&nbsp;&nbsp;8</span>&nbsp;*<br>
<span id=9 class="line">&nbsp;&nbsp;&nbsp;9</span>&nbsp;*/</comment><br>
<span id=10 class="line">&nbsp;&nbsp;10</span><br>
<span id=11 class="line">&nbsp;&nbsp;11</span>&nbsp;<comment>/**&nbsp;*/</comment><br>
<span id=12 class="line">&nbsp;&nbsp;12</span>const&nbsp;XLSX	=&nbsp;require('xlsx');<br>
<span id=13 class="line">&nbsp;&nbsp;13</span><br>
<span id=14 class="line">&nbsp;&nbsp;14</span>import&nbsp;{&nbsp;log&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;'./';<br>
<span id=15 class="line">&nbsp;&nbsp;15</span>import&nbsp;{&nbsp;DataRow}&nbsp;&nbsp;&nbsp;from&nbsp;'hsdata';<br>
<span id=16 class="line">&nbsp;&nbsp;16</span>import&nbsp;{&nbsp;WorkBook,<br>
<span id=17 class="line">&nbsp;&nbsp;17</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WorkSheet,<br>
<span id=18 class="line">&nbsp;&nbsp;18</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CellObject<br>
<span id=19 class="line">&nbsp;&nbsp;19</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;'xlsx/types';<br>
<span id=20 class="line">&nbsp;&nbsp;20</span><br>
<span id=21 class="line">&nbsp;&nbsp;21</span>log.prefix('XL');<br>
<span id=22 class="line">&nbsp;&nbsp;22</span><br>
<span id=23 class="line">&nbsp;&nbsp;23</span><br>
<span id=24 class="line">&nbsp;&nbsp;24</span><comment>/**<br>
<span id=25 class="line">&nbsp;&nbsp;25</span>&nbsp;*&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;promise&nbsp;for&nbsp;an&nbsp;{@link&nbsp;#/hsLog/hsNode.excelFile&nbsp;excel&nbsp;file}.<br>
<span id=26 class="line">&nbsp;&nbsp;26</span>&nbsp;*&nbsp;```<br>
<span id=27 class="line">&nbsp;&nbsp;27</span>&nbsp;*&nbsp;{<br>
<span id=28 class="line">&nbsp;&nbsp;28</span>&nbsp;*&nbsp;	&nbsp;&nbsp;	{@link&nbsp;excel.readFile.getSheetNames&nbsp;getSheetNames},<br>
<span id=29 class="line">&nbsp;&nbsp;29</span>&nbsp;*&nbsp;		{@link&nbsp;excel.readFile.getTableColumns&nbsp;getTableColumns},<br>
<span id=30 class="line">&nbsp;&nbsp;30</span>&nbsp;*&nbsp;		{@link&nbsp;excel.readFile.getRowsForTable&nbsp;getRowsForTable},<br>
<span id=31 class="line">&nbsp;&nbsp;31</span>&nbsp;*&nbsp;		{@link&nbsp;excel.readFile.getTable&nbsp;getTable},<br>
<span id=32 class="line">&nbsp;&nbsp;32</span>&nbsp;*&nbsp;		{@link&nbsp;excel.readFile.nextExcelColIndex&nbsp;nextExcelColIndex},<br>
<span id=33 class="line">&nbsp;&nbsp;33</span>&nbsp;*&nbsp;		{@link&nbsp;excel.readFile.getCellValue&nbsp;getCellValue}<br>
<span id=34 class="line">&nbsp;&nbsp;34</span>&nbsp;*&nbsp;}<br>
<span id=35 class="line">&nbsp;&nbsp;35</span>&nbsp;*&nbsp;```<br>
<span id=36 class="line">&nbsp;&nbsp;36</span>&nbsp;*&nbsp;#&nbsp;Usage<br>
<span id=37 class="line">&nbsp;&nbsp;37</span>&nbsp;*&nbsp;```<br>
<span id=38 class="line">&nbsp;&nbsp;38</span>&nbsp;*&nbsp;const&nbsp;excel&nbsp;=&nbsp;require('./hsNode.excel');<br>
<span id=39 class="line">&nbsp;&nbsp;39</span>&nbsp;*&nbsp;const&nbsp;excelFile&nbsp;=&nbsp;excel.excelFile('./aFile.xlsx');<br>
<span id=40 class="line">&nbsp;&nbsp;40</span>&nbsp;*&nbsp;```&nbsp;<br>
<span id=41 class="line">&nbsp;&nbsp;41</span>&nbsp;*&nbsp;@param&nbsp;name&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;Excel&nbsp;file&nbsp;to&nbsp;read<br>
<span id=42 class="line">&nbsp;&nbsp;42</span>&nbsp;*&nbsp;@returns&nbsp;an&nbsp;object&nbsp;of&nbsp;functions&nbsp;providing&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;excel&nbsp;file.<br>
<span id=43 class="line">&nbsp;&nbsp;43</span>&nbsp;*/</comment><br>
<span id=44 class="line">&nbsp;&nbsp;44</span>export&nbsp;function&nbsp;readFile(name:string,&nbsp;options?:any):ExcelFile&nbsp;{&nbsp;<br>
<span id=45 class="line">&nbsp;&nbsp;45</span>&nbsp;&nbsp;&nbsp;&nbsp;//-----------&nbsp;private&nbsp;methods&nbsp;------------------<br>
<span id=46 class="line">&nbsp;&nbsp;46</span>	let&nbsp;workbook:WorkBook;<br>
<span id=47 class="line">&nbsp;&nbsp;47</span>	<br>
<span id=48 class="line">&nbsp;&nbsp;48</span>	<comment>/**<br>
<span id=49 class="line">&nbsp;&nbsp;49</span>	&nbsp;*&nbsp;returns&nbsp;the&nbsp;value&nbsp;of&nbsp;a&nbsp;cell,&nbsp;or&nbsp;undefined<br>
<span id=50 class="line">&nbsp;&nbsp;50</span>	&nbsp;*&nbsp;@param&nbsp;sheet&nbsp;the&nbsp;sheet&nbsp;object&nbsp;or&nbsp;sheet&nbsp;name&nbsp;to&nbsp;retrieve&nbsp;cells&nbsp;from;<br>
<span id=51 class="line">&nbsp;&nbsp;51</span>	&nbsp;*&nbsp;@param&nbsp;col&nbsp;the&nbsp;column&nbsp;index&nbsp;('A',...)<br>
<span id=52 class="line">&nbsp;&nbsp;52</span>	&nbsp;*&nbsp;@param&nbsp;row&nbsp;index&nbsp;(1,...)<br>
<span id=53 class="line">&nbsp;&nbsp;53</span>	&nbsp;*&nbsp;@returns&nbsp;the&nbsp;value&nbsp;of&nbsp;a&nbsp;cell,&nbsp;or&nbsp;undefined<br>
<span id=54 class="line">&nbsp;&nbsp;54</span>	&nbsp;*/</comment><br>
<span id=55 class="line">&nbsp;&nbsp;55</span>	function&nbsp;getCellValue(sheet:string|WorkSheet,&nbsp;col:string,&nbsp;row:number):string&nbsp;{<br>
<span id=56 class="line">&nbsp;&nbsp;56</span>		if&nbsp;(typeof&nbsp;sheet&nbsp;===&nbsp;'string')&nbsp;{&nbsp;sheet&nbsp;=&nbsp;workbook.Sheets[sheet];&nbsp;}&nbsp;<br>
<span id=57 class="line">&nbsp;&nbsp;57</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c:CellObject;<br>
<span id=58 class="line">&nbsp;&nbsp;58</span>		if&nbsp;(sheet[col+row]&nbsp;&&&nbsp;sheet[col+row].v!=='')&nbsp;{&nbsp;<br>
<span id=59 class="line">&nbsp;&nbsp;59</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;sheet[col+row];<br>
<span id=60 class="line">&nbsp;&nbsp;60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;val&nbsp;=&nbsp;c.w!==undefined?&nbsp;c.w&nbsp;:&nbsp;c.v;<br>
<span id=61 class="line">&nbsp;&nbsp;61</span>			if&nbsp;(c)&nbsp;{&nbsp;switch(c.t)&nbsp;{<br>
<span id=62 class="line">&nbsp;&nbsp;62</span>				case&nbsp;'s':&nbsp;return&nbsp;(<string>val).replace(/,/g,';').replace(/[\n\r]+/g,'&nbsp;').trim();<br>
<span id=63 class="line">&nbsp;&nbsp;63</span>				case&nbsp;'n':&nbsp;<comment>/*&nbsp;falls&nbsp;through&nbsp;*/</comment>&nbsp;<br>
<span id=64 class="line">&nbsp;&nbsp;64</span>				default:&nbsp;return&nbsp;c.w.replace(/,/g,'');<br>
<span id=65 class="line">&nbsp;&nbsp;65</span>			}}<br>
<span id=66 class="line">&nbsp;&nbsp;66</span>		}<br>
<span id=67 class="line">&nbsp;&nbsp;67</span>		return&nbsp;'';&nbsp;<br>
<span id=68 class="line">&nbsp;&nbsp;68</span>	}<br>
<span id=69 class="line">&nbsp;&nbsp;69</span>	<br>
<span id=70 class="line">&nbsp;&nbsp;70</span>	<comment>/**<br>
<span id=71 class="line">&nbsp;&nbsp;71</span>	&nbsp;*&nbsp;**Generator**,&nbsp;yields&nbsp;consecutive&nbsp;cell&nbsp;values&nbsp;over&nbsp;a&nbsp;row<br>
<span id=72 class="line">&nbsp;&nbsp;72</span>	&nbsp;*&nbsp;@param&nbsp;sheet&nbsp;the&nbsp;sheet&nbsp;object&nbsp;or&nbsp;sheet&nbsp;name&nbsp;to&nbsp;retrieve&nbsp;cells&nbsp;from;<br>
<span id=73 class="line">&nbsp;&nbsp;73</span>	&nbsp;*&nbsp;@param&nbsp;row&nbsp;the&nbsp;row&nbsp;to&nbsp;iterate&nbsp;over<br>
<span id=74 class="line">&nbsp;&nbsp;74</span>	&nbsp;*&nbsp;@param&nbsp;colIterator&nbsp;iterable&nbsp;over&nbsp;columns;<br>
<span id=75 class="line">&nbsp;&nbsp;75</span>	&nbsp;*&nbsp;or&nbsp;an&nbsp;iterable&nbsp;that&nbsp;generates&nbsp;column&nbsp;indices.<br>
<span id=76 class="line">&nbsp;&nbsp;76</span>	&nbsp;*/</comment><br>
<span id=77 class="line">&nbsp;&nbsp;77</span>	function*&nbsp;getCellValues(sheet:WorkSheet,&nbsp;row:number,&nbsp;colIterator:string[])&nbsp;{<br>
<span id=78 class="line">&nbsp;&nbsp;78</span>		for&nbsp;(let&nbsp;col&nbsp;of&nbsp;colIterator)&nbsp;{<br>
<span id=79 class="line">&nbsp;&nbsp;79</span>			yield&nbsp;getCellValue(sheet,&nbsp;col,&nbsp;row);&nbsp;<br>
<span id=80 class="line">&nbsp;&nbsp;80</span>		}<br>
<span id=81 class="line">&nbsp;&nbsp;81</span>	}<br>
<span id=82 class="line">&nbsp;&nbsp;82</span>	<br>
<span id=83 class="line">&nbsp;&nbsp;83</span>	<comment>/**<br>
<span id=84 class="line">&nbsp;&nbsp;84</span>	&nbsp;*&nbsp;**Generator**,&nbsp;yields&nbsp;consecutive&nbsp;column&nbsp;names&nbsp;as&nbsp;an&nbsp;<br>
<span id=85 class="line">&nbsp;&nbsp;85</span>	&nbsp;*&nbsp;{col,&nbsp;name}&nbsp;object.&nbsp;<br>
<span id=86 class="line">&nbsp;&nbsp;86</span>	&nbsp;*&nbsp;The&nbsp;generator&nbsp;exits&nbsp;when&nbsp;the&nbsp;first&nbsp;empty&nbsp;column&nbsp;name&nbsp;is&nbsp;encountered.<br>
<span id=87 class="line">&nbsp;&nbsp;87</span>	&nbsp;*&nbsp;@param&nbsp;sheet&nbsp;the&nbsp;sheet&nbsp;to&nbsp;scan<br>
<span id=88 class="line">&nbsp;&nbsp;88</span>	&nbsp;*&nbsp;@param&nbsp;row&nbsp;the&nbsp;row&nbsp;to&nbsp;scan<br>
<span id=89 class="line">&nbsp;&nbsp;89</span>	&nbsp;*&nbsp;@param&nbsp;startCol&nbsp;defaults&nbsp;to&nbsp;'A'<br>
<span id=90 class="line">&nbsp;&nbsp;90</span>	&nbsp;*/</comment><br>
<span id=91 class="line">&nbsp;&nbsp;91</span>	function*&nbsp;getConsecutiveColumnNames(sheet:WorkSheet,&nbsp;row:number,&nbsp;startCol='A')&nbsp;{<br>
<span id=92 class="line">&nbsp;&nbsp;92</span>		for&nbsp;(let&nbsp;col&nbsp;of&nbsp;nextExcelColIndex(startCol))&nbsp;{<br>
<span id=93 class="line">&nbsp;&nbsp;93</span>			if&nbsp;(!getCellValue(sheet,&nbsp;col,&nbsp;row))&nbsp;{&nbsp;break;&nbsp;}<br>
<span id=94 class="line">&nbsp;&nbsp;94</span>			yield&nbsp;{col:col,&nbsp;name:getCellValue(sheet,&nbsp;col,&nbsp;row)};&nbsp;<br>
<span id=95 class="line">&nbsp;&nbsp;95</span>		}<br>
<span id=96 class="line">&nbsp;&nbsp;96</span>	}<br>
<span id=97 class="line">&nbsp;&nbsp;97</span><br>
<span id=98 class="line">&nbsp;&nbsp;98</span>	<comment>/**<br>
<span id=99 class="line">&nbsp;&nbsp;99</span>	&nbsp;*&nbsp;returns&nbsp;an&nbsp;array[c]&nbsp;of&nbsp;values&nbsp;from&nbsp;columns&nbsp;that&nbsp;match&nbsp;indices&nbsp;provided&nbsp;`columns`.<br>
<span id=100 class="line">&nbsp;100</span>	&nbsp;*&nbsp;@param&nbsp;sheet&nbsp;the&nbsp;sheet&nbsp;object&nbsp;or&nbsp;sheet&nbsp;name&nbsp;to&nbsp;retrieve&nbsp;cells&nbsp;from;<br>
<span id=101 class="line">&nbsp;101</span>	&nbsp;*&nbsp;@param&nbsp;row&nbsp;the&nbsp;row&nbsp;to&nbsp;iterate&nbsp;over<br>
<span id=102 class="line">&nbsp;102</span>	&nbsp;*&nbsp;@param&nbsp;columns&nbsp;a)&nbsp;an&nbsp;array&nbsp;of&nbsp;column&nbsp;names.&nbsp;b)&nbsp;an&nbsp;{from:'A',&nbsp;to:'Z'}&nbsp;object&nbsp;<br>
<span id=103 class="line">&nbsp;103</span>	&nbsp;*&nbsp;@return&nbsp;array&nbsp;of&nbsp;column&nbsp;values&nbsp;in&nbsp;the&nbsp;row<br>
<span id=104 class="line">&nbsp;104</span>	&nbsp;*/</comment><br>
<span id=105 class="line">&nbsp;105</span>	function&nbsp;getRow(sheet:WorkSheet,&nbsp;row:number,&nbsp;columns:string[])&nbsp;{<br>
<span id=106 class="line">&nbsp;106</span>		let&nbsp;result&nbsp;=&nbsp;[...getCellValues(sheet,&nbsp;row,&nbsp;columns)];<br>
<span id=107 class="line">&nbsp;107</span>		return&nbsp;result;<br>
<span id=108 class="line">&nbsp;108</span>	}<br>
<span id=109 class="line">&nbsp;109</span><br>
<span id=110 class="line">&nbsp;110</span>	<comment>/**<br>
<span id=111 class="line">&nbsp;111</span>	&nbsp;*&nbsp;returns&nbsp;the&nbsp;value&nbsp;of&nbsp;a&nbsp;cell,&nbsp;or&nbsp;undefined<br>
<span id=112 class="line">&nbsp;112</span>	&nbsp;*&nbsp;@param&nbsp;sheetName&nbsp;the&nbsp;sheet&nbsp;object&nbsp;or&nbsp;sheet&nbsp;name&nbsp;to&nbsp;retrieve&nbsp;cells&nbsp;from;<br>
<span id=113 class="line">&nbsp;113</span>	&nbsp;*&nbsp;@param&nbsp;row&nbsp;index&nbsp;(1,...)<br>
<span id=114 class="line">&nbsp;114</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;it&nbsp;an&nbsp;iterator&nbsp;over&nbsp;columns<br>
<span id=115 class="line">&nbsp;115</span>	&nbsp;*&nbsp;@returns&nbsp;the&nbsp;value&nbsp;of&nbsp;a&nbsp;cell,&nbsp;or&nbsp;undefined<br>
<span id=116 class="line">&nbsp;116</span>	&nbsp;*/</comment><br>
<span id=117 class="line">&nbsp;117</span>	function&nbsp;constructCol(sheetName:string,&nbsp;row:number,&nbsp;it:any):TableStruct&nbsp;{<br>
<span id=118 class="line">&nbsp;118</span>		let&nbsp;result:TableStruct&nbsp;=&nbsp;{<br>
<span id=119 class="line">&nbsp;119</span>			names:[],<br>
<span id=120 class="line">&nbsp;120</span>			sheetName:&nbsp;sheetName,<br>
<span id=121 class="line">&nbsp;121</span>			headerRow:&nbsp;row,<br>
<span id=122 class="line">&nbsp;122</span>			colIndex:&nbsp;&nbsp;<string[]>[]<br>
<span id=123 class="line">&nbsp;123</span>		};<br>
<span id=124 class="line">&nbsp;124</span>		for&nbsp;(let&nbsp;col&nbsp;of&nbsp;it)&nbsp;{<br>
<span id=125 class="line">&nbsp;125</span>			result.names.push(col.name);<br>
<span id=126 class="line">&nbsp;126</span>			result.colIndex.push(col.col);<br>
<span id=127 class="line">&nbsp;127</span>		}<br>
<span id=128 class="line">&nbsp;128</span>		return&nbsp;result;<br>
<span id=129 class="line">&nbsp;129</span>	}<br>
<span id=130 class="line">&nbsp;130</span><br>
<span id=131 class="line">&nbsp;131</span>	<comment>/**<br>
<span id=132 class="line">&nbsp;132</span>	&nbsp;*&nbsp;gets&nbsp;a&nbsp;table&nbsp;of&nbsp;values,&nbsp;starting&nbsp;at&nbsp;the&nbsp;startCol&nbsp;and&nbsp;startRow.<br>
<span id=133 class="line">&nbsp;133</span>	&nbsp;*&nbsp;The&nbsp;table&nbsp;includes&nbsp;all&nbsp;consecutive&nbsp;columns&nbsp;with&nbsp;valid&nbsp;names,&nbsp;and&nbsp;all&nbsp;consecutive<br>
<span id=134 class="line">&nbsp;134</span>	&nbsp;*&nbsp;rows&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;valid&nbsp;cell&nbsp;value.<br>
<span id=135 class="line">&nbsp;135</span>	&nbsp;*&nbsp;@param&nbsp;sheetID&nbsp;the&nbsp;sheet&nbsp;name&nbsp;or&nbsp;index&nbsp;from&nbsp;which&nbsp;to&nbsp;get&nbsp;the&nbsp;table<br>
<span id=136 class="line">&nbsp;136</span>	&nbsp;*&nbsp;@param&nbsp;startCol&nbsp;determines&nbsp;the&nbsp;left&nbsp;edge&nbsp;of&nbsp;the&nbsp;table;&nbsp;defaults&nbsp;to&nbsp;'A'<br>
<span id=137 class="line">&nbsp;137</span>	&nbsp;*&nbsp;@param&nbsp;startRow&nbsp;determines&nbsp;the&nbsp;top&nbsp;edge&nbsp;of&nbsp;the&nbsp;table;&nbsp;defaults&nbsp;to&nbsp;1<br>
<span id=138 class="line">&nbsp;138</span>	&nbsp;*&nbsp;@returns&nbsp;a&nbsp;tuple&nbsp;of&nbsp;{columns,&nbsp;table}&nbsp;<br>
<span id=139 class="line">&nbsp;139</span>	&nbsp;*/</comment><br>
<span id=140 class="line">&nbsp;140</span>	function&nbsp;getTable(sheetID:string|number,&nbsp;startCol='A',&nbsp;startRow=1)&nbsp;{<br>
<span id=141 class="line">&nbsp;141</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;sheetName&nbsp;=&nbsp;(typeof&nbsp;sheetID&nbsp;===&nbsp;'string')?&nbsp;sheetID&nbsp;:&nbsp;getSheetNames()[sheetID];<br>
<span id=142 class="line">&nbsp;142</span>		const&nbsp;columns:TableStruct&nbsp;=&nbsp;getTableColumns(sheetName,&nbsp;startCol,&nbsp;startRow);<br>
<span id=143 class="line">&nbsp;143</span>		const&nbsp;table:DataRow[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;getRowsForTable(columns);<br>
<span id=144 class="line">&nbsp;144</span>		return&nbsp;{columns,&nbsp;table};<br>
<span id=145 class="line">&nbsp;145</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span id=146 class="line">&nbsp;146</span>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<span id=147 class="line">&nbsp;147</span><br>
<span id=148 class="line">&nbsp;148</span>&nbsp;&nbsp;&nbsp;&nbsp;//-----------&nbsp;public&nbsp;methods&nbsp;------------------<br>
<span id=149 class="line">&nbsp;149</span>	<comment>/**<br>
<span id=150 class="line">&nbsp;150</span>	&nbsp;*&nbsp;retrieves&nbsp;sheet&nbsp;names&nbsp;from&nbsp;a&nbsp;file<br>
<span id=151 class="line">&nbsp;151</span>	&nbsp;*&nbsp;@returns&nbsp;{[string]}&nbsp;an&nbsp;array&nbsp;of&nbsp;sheet&nbsp;names<br>
<span id=152 class="line">&nbsp;152</span>	&nbsp;*/</comment><br>
<span id=153 class="line">&nbsp;153</span>	function&nbsp;getSheetNames():string[]&nbsp;{<br>
<span id=154 class="line">&nbsp;154</span>		let&nbsp;names:string[]&nbsp;=&nbsp;[];<br>
<span id=155 class="line">&nbsp;155</span>		for&nbsp;(let&nbsp;s&nbsp;in&nbsp;workbook.Sheets)&nbsp;{&nbsp;<br>
<span id=156 class="line">&nbsp;156</span>			names.push(s);<br>
<span id=157 class="line">&nbsp;157</span>		}<br>
<span id=158 class="line">&nbsp;158</span>		return&nbsp;names;<br>
<span id=159 class="line">&nbsp;159</span>	}<br>
<span id=160 class="line">&nbsp;160</span><br>
<span id=161 class="line">&nbsp;161</span>	<comment>/**<br>
<span id=162 class="line">&nbsp;162</span>	&nbsp;*&nbsp;getTableColumns&nbsp;retrieves&nbsp;an&nbsp;array&nbsp;of&nbsp;consecutive&nbsp;valid&nbsp;column&nbsp;names.<br>
<span id=163 class="line">&nbsp;163</span>	&nbsp;*&nbsp;@param&nbsp;sheetName&nbsp;the&nbsp;sheet&nbsp;object&nbsp;to&nbsp;retrieve&nbsp;cells&nbsp;from<br>
<span id=164 class="line">&nbsp;164</span>	&nbsp;*&nbsp;@param&nbsp;startCol&nbsp;the&nbsp;first&nbsp;column&nbsp;of&nbsp;the&nbsp;table;&nbsp;defaults&nbsp;to&nbsp;'A'.<br>
<span id=165 class="line">&nbsp;165</span>	&nbsp;*&nbsp;@param&nbsp;row&nbsp;the&nbsp;row&nbsp;to&nbsp;iterate&nbsp;over;&nbsp;defaults&nbsp;to&nbsp;1.<br>
<span id=166 class="line">&nbsp;166</span>	&nbsp;*&nbsp;@returns&nbsp;an&nbsp;excel&nbsp;tabkle&nbsp;description<br>
<span id=167 class="line">&nbsp;167</span>	&nbsp;*/</comment><br>
<span id=168 class="line">&nbsp;168</span>	function&nbsp;getTableColumns(sheetName:string,&nbsp;startCol='A',&nbsp;row=1):TableStruct&nbsp;{<br>
<span id=169 class="line">&nbsp;169</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;sheet:WorkSheet&nbsp;=&nbsp;workbook.Sheets[sheetName];<br>
<span id=170 class="line">&nbsp;170</span>		return&nbsp;constructCol(sheetName,&nbsp;row,&nbsp;getConsecutiveColumnNames(sheet,&nbsp;row,&nbsp;startCol));<br>
<span id=171 class="line">&nbsp;171</span>	}<br>
<span id=172 class="line">&nbsp;172</span>	<br>
<span id=173 class="line">&nbsp;173</span>	<comment>/**<br>
<span id=174 class="line">&nbsp;174</span>	&nbsp;*&nbsp;getRowsForTable&nbsp;returns&nbsp;a&nbsp;2D&nbsp;array[r][c]&nbsp;of&nbsp;row&nbsp;values,&nbsp;where&nbsp;the&nbsp;columns&nbsp;match&nbsp;the&nbsp;provided&nbsp;<br>
<span id=175 class="line">&nbsp;175</span>	&nbsp;*&nbsp;columns&nbsp;names.&nbsp;<br>
<span id=176 class="line">&nbsp;176</span>	&nbsp;*&nbsp;@param&nbsp;table&nbsp;an&nbsp;array&nbsp;of&nbsp;column&nbsp;descriptors.&nbsp;<br>
<span id=177 class="line">&nbsp;177</span>	&nbsp;*&nbsp;@param&nbsp;maxRows&nbsp;if&nbsp;specified,&nbsp;determines&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;rows&nbsp;to&nbsp;scan&nbsp;for.&nbsp;<br>
<span id=178 class="line">&nbsp;178</span>	&nbsp;*&nbsp;If&nbsp;omitted,&nbsp;iteration&nbsp;stops&nbsp;when&nbsp;the&nbsp;first&nbsp;row&nbsp;of&nbsp;empty&nbsp;values&nbsp;is&nbsp;encountered.<br>
<span id=179 class="line">&nbsp;179</span>	&nbsp;*/</comment><br>
<span id=180 class="line">&nbsp;180</span>	function&nbsp;getRowsForTable(table:TableStruct,&nbsp;maxRows=0):DataRow[]&nbsp;{<br>
<span id=181 class="line">&nbsp;181</span>		if&nbsp;(!table.sheetName)&nbsp;{&nbsp;throw&nbsp;new&nbsp;Error('illegal&nbsp;table&nbsp;parameter&nbsp;in&nbsp;getRowsForTable');&nbsp;}<br>
<span id=182 class="line">&nbsp;182</span>		let&nbsp;sheet:WorkSheet&nbsp;=&nbsp;workbook.Sheets[table.sheetName];<br>
<span id=183 class="line">&nbsp;183</span>		let&nbsp;result:DataRow[]&nbsp;=&nbsp;[];<br>
<span id=184 class="line">&nbsp;184</span>		let&nbsp;row=0;&nbsp;<br>
<span id=185 class="line">&nbsp;185</span>		while&nbsp;(true)&nbsp;{<br>
<span id=186 class="line">&nbsp;186</span>			let&nbsp;newRow&nbsp;=&nbsp;getRow(sheet,&nbsp;row+table.headerRow+1,&nbsp;table.colIndex);<br>
<span id=187 class="line">&nbsp;187</span>			let&nbsp;filledCells&nbsp;=&nbsp;0;<br>
<span id=188 class="line">&nbsp;188</span>			for&nbsp;(let&nbsp;c&nbsp;in&nbsp;newRow)&nbsp;{&nbsp;if&nbsp;(newRow[c])&nbsp;{&nbsp;filledCells++;&nbsp;}}<br>
<span id=189 class="line">&nbsp;189</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row++;<br>
<span id=190 class="line">&nbsp;190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;only&nbsp;return&nbsp;non-empty&nbsp;rows<br>
<span id=191 class="line">&nbsp;191</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(filledCells&nbsp;>&nbsp;0)&nbsp;{&nbsp;result.push(newRow);&nbsp;}<br>
<span id=192 class="line">&nbsp;192</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;if&nbsp;no&nbsp;maxRows&nbsp;specified:&nbsp;break&nbsp;upon&nbsp;first&nbsp;empty&nbsp;row<br>
<span id=193 class="line">&nbsp;193</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(maxRows<=0)&nbsp;{&nbsp;&nbsp;break;&nbsp;}<br>
<span id=194 class="line">&nbsp;194</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;if&nbsp;rows&nbsp;exceed&nbsp;maxRows:&nbsp;break;<br>
<span id=195 class="line">&nbsp;195</span>			if&nbsp;(maxRows>0&nbsp;&&&nbsp;row>=maxRows)&nbsp;{&nbsp;break;&nbsp;}<br>
<span id=196 class="line">&nbsp;196</span>		}<br>
<span id=197 class="line">&nbsp;197</span>		return&nbsp;result;<br>
<span id=198 class="line">&nbsp;198</span>	}<br>
<span id=199 class="line">&nbsp;199</span>	<br>
<span id=200 class="line">&nbsp;200</span>&nbsp;&nbsp;&nbsp;&nbsp;<comment>/**<br>
<span id=201 class="line">&nbsp;201</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;**generator**&nbsp;for&nbsp;Excel&nbsp;column&nbsp;indices&nbsp;starting&nbsp;at&nbsp;startCol.&nbsp;<br>
<span id=202 class="line">&nbsp;202</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Following&nbsp;'Z'&nbsp;the&nbsp;next&nbsp;column&nbsp;generated&nbsp;is&nbsp;'AA'&nbsp;and&nbsp;so&nbsp;on.&nbsp;The&nbsp;generator&nbsp;<br>
<span id=203 class="line">&nbsp;203</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;starts&nbsp;with&nbsp;producing&nbsp;startCol&nbsp;as&nbsp;first&nbsp;index.<br>
<span id=204 class="line">&nbsp;204</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;#&nbsp;Usage<br>
<span id=205 class="line">&nbsp;205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;```<br>
<span id=206 class="line">&nbsp;206</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;for&nbsp;(col&nbsp;of&nbsp;file.nextExcelColIndex(startCol='Y')&nbsp;{&nbsp;<br>
<span id=207 class="line">&nbsp;207</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;printf("%s,&nbsp;",&nbsp;col);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;->&nbsp;Y,&nbsp;Z,&nbsp;AA,&nbsp;AB<br>
<span id=208 class="line">&nbsp;208</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(col&nbsp;===&nbsp;'AB')&nbsp;&nbsp;{&nbsp;break;&nbsp;}<br>
<span id=209 class="line">&nbsp;209</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;}<br>
<span id=210 class="line">&nbsp;210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;```<br>
<span id=211 class="line">&nbsp;211</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;startCol&nbsp;the&nbsp;first&nbsp;column&nbsp;index&nbsp;('A',&nbsp;....)&nbsp;to&nbsp;yield;&nbsp;defaults&nbsp;to&nbsp;'A'<br>
<span id=212 class="line">&nbsp;212</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</comment><br>
<span id=213 class="line">&nbsp;213</span>&nbsp;&nbsp;&nbsp;&nbsp;function*&nbsp;nextExcelColIndex(startCol='A'):IterableIterator<string>&nbsp;{<br>
<span id=214 class="line">&nbsp;214</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;nextChar(c:string):string&nbsp;{&nbsp;return&nbsp;String.fromCharCode(c.charCodeAt(0)&nbsp;+&nbsp;1);&nbsp;}<br>
<span id=215 class="line">&nbsp;215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<span id=216 class="line">&nbsp;216</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;c&nbsp;=&nbsp;startCol;<br>
<span id=217 class="line">&nbsp;217</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(true)&nbsp;{<br>
<span id=218 class="line">&nbsp;218</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yield&nbsp;c;<br>
<span id=219 class="line">&nbsp;219</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c.length&nbsp;===&nbsp;1)&nbsp;{<br>
<span id=220 class="line">&nbsp;220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;(c&nbsp;<&nbsp;'Z')?&nbsp;nextChar(c[0])&nbsp;:&nbsp;'AA';<br>
<span id=221 class="line">&nbsp;221</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
<span id=222 class="line">&nbsp;222</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;ch&nbsp;=&nbsp;nextChar(c[1]);<br>
<span id=223 class="line">&nbsp;223</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;(ch&nbsp;>&nbsp;'Z')?&nbsp;nextChar(c[0])+'A'&nbsp;:&nbsp;c[0]&nbsp;+&nbsp;ch;<br>
<span id=224 class="line">&nbsp;224</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span id=225 class="line">&nbsp;225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span id=226 class="line">&nbsp;226</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span id=227 class="line">&nbsp;227</span>	log.debug('reading&nbsp;file&nbsp;'&nbsp;+&nbsp;name);<br>
<span id=228 class="line">&nbsp;228</span>	workbook&nbsp;=&nbsp;XLSX.readFile(name,&nbsp;options);<br>
<span id=229 class="line">&nbsp;229</span>	return&nbsp;{<br>
<span id=230 class="line">&nbsp;230</span>		getSheetNames:		getSheetNames,<br>
<span id=231 class="line">&nbsp;231</span>		getTableColumns:	getTableColumns,<br>
<span id=232 class="line">&nbsp;232</span>		getRowsForTable:	getRowsForTable,<br>
<span id=233 class="line">&nbsp;233</span>		getTable:			getTable,<br>
<span id=234 class="line">&nbsp;234</span>		nextExcelColIndex:	nextExcelColIndex,<br>
<span id=235 class="line">&nbsp;235</span>		getCellValue:		getCellValue		<br>
<span id=236 class="line">&nbsp;236</span>	};<br>
<span id=237 class="line">&nbsp;237</span>}<br>
<span id=238 class="line">&nbsp;238</span><br>
<span id=239 class="line">&nbsp;239</span><br>
<span id=240 class="line">&nbsp;240</span><comment>/**<br>
<span id=241 class="line">&nbsp;241</span>&nbsp;*&nbsp;A&nbsp;structure&nbsp;describing&nbsp;an&nbsp;Excel&nbsp;table<br>
<span id=242 class="line">&nbsp;242</span>&nbsp;*/</comment><br>
<span id=243 class="line">&nbsp;243</span>export&nbsp;interface&nbsp;TableStruct&nbsp;{<br>
<span id=244 class="line">&nbsp;244</span>&nbsp;&nbsp;&nbsp;&nbsp;names:string[];<br>
<span id=245 class="line">&nbsp;245</span>&nbsp;&nbsp;&nbsp;&nbsp;sheetName:string;<br>
<span id=246 class="line">&nbsp;246</span>&nbsp;&nbsp;&nbsp;&nbsp;headerRow:number;<br>
<span id=247 class="line">&nbsp;247</span>&nbsp;&nbsp;&nbsp;&nbsp;colIndex:string[];&nbsp;<br>
<span id=248 class="line">&nbsp;248</span>}<br>
<span id=249 class="line">&nbsp;249</span><br>
<span id=250 class="line">&nbsp;250</span><comment>/**<br>
<span id=251 class="line">&nbsp;251</span>&nbsp;*&nbsp;<br>
<span id=252 class="line">&nbsp;252</span>&nbsp;*/</comment><br>
<span id=253 class="line">&nbsp;253</span>export&nbsp;interface&nbsp;Table&nbsp;{<br>
<span id=254 class="line">&nbsp;254</span>&nbsp;&nbsp;&nbsp;&nbsp;columns:TableStruct;<br>
<span id=255 class="line">&nbsp;255</span>&nbsp;&nbsp;&nbsp;&nbsp;table:DataRow[];<br>
<span id=256 class="line">&nbsp;256</span>}<br>
<span id=257 class="line">&nbsp;257</span><br>
<span id=258 class="line">&nbsp;258</span>export&nbsp;interface&nbsp;ExcelFile&nbsp;{<br>
<span id=259 class="line">&nbsp;259</span>&nbsp;&nbsp;&nbsp;&nbsp;getSheetNames:		()&nbsp;=>string[];<br>
<span id=260 class="line">&nbsp;260</span>&nbsp;&nbsp;&nbsp;&nbsp;getTableColumns:	(sheetName:string,&nbsp;startCol?:string,&nbsp;row?:number)&nbsp;=>&nbsp;TableStruct;<br>
<span id=261 class="line">&nbsp;261</span>&nbsp;&nbsp;&nbsp;&nbsp;getRowsForTable:	(table:TableStruct,&nbsp;maxRows?:number)&nbsp;=>&nbsp;DataRow[];<br>
<span id=262 class="line">&nbsp;262</span>&nbsp;&nbsp;&nbsp;&nbsp;getTable:			(sheetID:string|number,&nbsp;startCol?:string,&nbsp;startRow?:number)&nbsp;=>&nbsp;Table;<br>
<span id=263 class="line">&nbsp;263</span>&nbsp;&nbsp;&nbsp;&nbsp;nextExcelColIndex:	(startCol?:string)&nbsp;=>&nbsp;IterableIterator<string>;<br>
<span id=264 class="line">&nbsp;264</span>&nbsp;&nbsp;&nbsp;&nbsp;getCellValue:		(sheet:string|WorkSheet,&nbsp;col:string,&nbsp;row:number)&nbsp;=>&nbsp;string;		<br>
<span id=265 class="line">&nbsp;265</span>}<br></code></div>
                </body>
            