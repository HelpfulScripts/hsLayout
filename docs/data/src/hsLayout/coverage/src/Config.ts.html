<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/Config.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">hsLayout: All files</a> / <a href="index.html">src</a> Config.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">7.14% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>2/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/22</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">8.33% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>2/24</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * ## Config 
 * Tool to configure a tree of mithril components via an object literal or as a JSON file.
 * The object format is `{ &lt;name&gt;: { &lt;Component&gt;: &lt;options&gt;}, ...}`.
 * The name `root` is required an defines the top of the tree. Other named sections are allowed and
 * can be used to structure the obect in a more readable and maintainable format.
 * 
 * ### Example:
 * In the example below, the comnponents `Layout`, `LeftNav`, `MainNav` will be resolved against modules
 * provided in the `context` parameter when creating the `Config` node. 
 * ```
 * {
 *  root: { Layout: {
 *      rows:  ["30px", "fill", "10px"],
 *      css: '.my-example',
 *      content: ['Header', 'Body', 'Footer]
 *  }},
 *  Header: { Layout:{
 *      columns: ["200px", "fill"],
 *      content: ['Left Header', 'Main Header']
 *  }},
 *  Body: { Layout:{
 *      columns: ["200px", "fill"], 
 *      content: ['LeftNav', 'MainNav']
 *  }},
 *  Footer: { Layout: {
 *      css: '.hs-site-footer',
 *      content: ['(c) Helpful ; Scripts']
 *  }},
 *  LeftNav:  { LeftNav:  { lib:"route.lib", field:"route.field"}},
 *  MainNav:  { MainNav:  { lib:"route.lib", field:"route.field"}}
 * }
 * ```
 * 
 * ### Calling pattern
 * Instantiate the component via
 * ```
 *  m(Config, { 
 *      source: src, // a file name, or obect literal
 *      context:[]   // a list of es6 modules against which to resolve components at runtime 
 *  });
 * ```
 * Additional parameters can be passed to the root node. The example below establishes routing and passes
 * `field` and `lib` to the root node:
 * ```
 *  class Router {
 *      view(node:Vnode) { 
 *          return m(Config, Object.assign({source: src, context: [hslayout, header, left, main]}, node.attrs));
 *      }
 *  }
 *  m.route(document.body, '/api', { 
 *      '/api':             Router,
 *      '/api/:lib':        Router,
 *      '/api/:lib/:field': Router
 *  });
 * ```
 */
&nbsp;
 /** */
import { m, Vnode } from './mithril'; 
&nbsp;
/**
 * `Component` class that creates a tree of mithril components out of a configuration obect or file.
 */
export class Config {
<span class="fstat-no" title="function not covered" >    oninit</span>(node:Vnode) {
        const context:any[] = <span class="cstat-no" title="statement not covered" >node.attrs.context;</span>
<span class="cstat-no" title="statement not covered" >        if (typeof node.attrs.source === 'string') { </span>
<span class="cstat-no" title="statement not covered" >            if (!node.state.cfg) { <span class="cstat-no" title="statement not covered" >m.request({ method: "GET", url: node.attrs.source }).then(<span class="fstat-no" title="function not covered" >(s</span>:any)=&gt; {</span></span>
// console.log(`Config read ${s}`);                
<span class="cstat-no" title="statement not covered" >                node.state.cfg = translate(s, s.root, context);</span>
            }); }      
        } else {
<span class="cstat-no" title="statement not covered" >            node.state.cfg = translate(node.attrs.source, node.attrs.source.root, context);</span>
        }
    }
<span class="fstat-no" title="function not covered" >    view</span>(node:Vnode) { 
        const cfg = <span class="cstat-no" title="statement not covered" >node.state.cfg;</span>
// console.log(`Config view ${cfg}`);        
<span class="cstat-no" title="statement not covered" >        return (cfg &amp;&amp; cfg.compClass)? m(cfg.compClass, Object.assign(cfg.attrs, node.attrs)) : m('div', 'waiting');</span>
    }
}
&nbsp;
/**
 * recursively translates a configuration, trying to fetch the class definition for each element (key) in `config`. 
 * If successful, it creates an object literal containing the component class and its attributes.
 * If unsuccessful, the element's value is returned unaltered so that it can be consumed 
 * by an instance further up in the recursion tree.
 * @param config an object literal containing the entire configuration tree
 * @param subcfg an object literal containing a configuration subtree
 * @param context an array of objects against which to instantiate elements of `config`.
 * @return an object literal representing the configuration, with Class names resolved 
 * against the provided `context`.
 */
function <span class="fstat-no" title="function not covered" >translate(</span>config:any, subcfg:any, context:any[]) {
    // resolve if synonym
<span class="cstat-no" title="statement not covered" >    if (isSynonym(config, subcfg)) { <span class="cstat-no" title="statement not covered" >subcfg = config[subcfg]; </span>}</span>
    // return if primitive
<span class="cstat-no" title="statement not covered" >    if (['string', 'number', 'boolean', 'function'].indexOf(typeof subcfg)&gt;=0) { <span class="cstat-no" title="statement not covered" >return subcfg; </span>}</span>
    let result = <span class="cstat-no" title="statement not covered" >subcfg.length? [] : {};</span>
    // step through options 
    const options = <span class="cstat-no" title="statement not covered" >Object.keys(subcfg);</span>
<span class="cstat-no" title="statement not covered" >    options.map(<span class="fstat-no" title="function not covered" >(o</span>pt:string):Vnode =&gt; {</span>
        const cl:any = <span class="cstat-no" title="statement not covered" >resolve(opt, context);</span>
        const content = <span class="cstat-no" title="statement not covered" >translate(config, subcfg[opt], context); </span>
<span class="cstat-no" title="statement not covered" >        if (cl) { </span>
            const r = <span class="cstat-no" title="statement not covered" >{</span>
                compClass:cl,   // Component class
                attrs:content   // attributes passed to the Component class
            };
<span class="cstat-no" title="statement not covered" >            (!Array.isArray(subcfg) &amp;&amp; options.length === 1)? </span>
                result = r : 
                result[opt] = r;   
        }
        else { <span class="cstat-no" title="statement not covered" >result[opt] = content; </span>}
    }); 
<span class="cstat-no" title="statement not covered" >    return result; </span>
}
&nbsp;
/**
 * resolves the symbol `sym` against the provided `context`.
 * If successful, returns the class definition for `sym`. 
 * @param sym the symbol to resolve
 * @param context the context to resolve against; `mithril` and `hsLayout` 
 * are implicitely part of the context and need not be specified.
 * @return the resolved Class, or `undefined`.
 */
function <span class="fstat-no" title="function not covered" >resolve(</span>sym:string, context:any[]) {
    let cl:any;
<span class="cstat-no" title="statement not covered" >    context.some(<span class="fstat-no" title="function not covered" >(c</span>:any) =&gt;  <span class="cstat-no" title="statement not covered" >cl = c[sym])</span>;</span>
<span class="cstat-no" title="statement not covered" >    return cl;</span>
}
&nbsp;
function <span class="fstat-no" title="function not covered" >isSynonym(</span>config:any, key:any) { <span class="cstat-no" title="statement not covered" >return typeof key === 'string' &amp;&amp; config[key]; </span>}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->

</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
